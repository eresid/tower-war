(()=>{"use strict";var t,e,s,i,h={594:function(t,e,s){var i,h,o=s(440),n=s.n(o),r=s(851),l=((i=l||{}).Blue="blue",i.Red="red",i.Yellow="yellow",i.Neutral="neutral",i);let a={blue:3900150,red:0xef4444,yellow:0xf59e0b,neutral:9741240};var c=((h=c||{})[h.Background=0]="Background",h[h.Paths=10]="Paths",h[h.Soldiers=20]="Soldiers",h[h.Towers=30]="Towers",h[h.UI=100]="UI",h);let d=t=>a[t];class f extends Phaser.GameObjects.Container{static spawn(t,e,s,i,h,o){return new f(t,e,s,i,h,o||60)}setOwner(t){this.owner=t,this.circle.fillColor=d(t)}setSelected(t){this.selectRing.setVisible(t)}updateLabel(){let t=60===Math.max(0,Math.floor(this.units))?"Max":`${this.units}`;this.label.setText(t)}tick(t){if("neutral"!==this.owner){this.lastGen+=t;let e=1500;if(this.lastGen>=e){let t=Math.floor(this.lastGen/e);this.units=Math.min(this.units+t,60),this.lastGen-=t*e,this.updateLabel()}}}constructor(t,e,s,i,h=10,n=60){super(t,e,s),(0,r._)(this,"owner",void 0),(0,r._)(this,"units",void 0),(0,r._)(this,"maxUnits",void 0),(0,r._)(this,"radius",void 0),(0,r._)(this,"circle",void 0),(0,r._)(this,"base",void 0),(0,r._)(this,"label",void 0),(0,r._)(this,"selectRing",void 0),(0,r._)(this,"lastGen",void 0),(0,r._)(this,"centerX",void 0),(0,r._)(this,"centerY",void 0),this.owner=i,this.units=Math.min(h,60),this.maxUnits=Math.min(n,60),this.radius=26,this.setSize(2*this.radius,2*this.radius),this.setDepth(30);const l=this.width/2,a=this.height/2;this.centerX=this.x+l,this.centerY=this.y+a,this.base=t.add.arc(l,a,this.radius+6,0,360,!1,0,.06),this.circle=t.add.arc(l,a,this.radius,0,360,!1,d(i),1),this.circle.setStrokeStyle(3,0xffffff,.9),this.label=t.add.text(l,a,`${this.units}`,{fontSize:"18px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.selectRing=t.add.arc(l,a,this.radius+10,0,360,!1,0,0).setStrokeStyle(3,3359061,.85).setVisible(!1),this.add([this.base,this.circle,this.label,this.selectRing]),t.add.existing(this);const c=new o.Geom.Circle(2*l,2*a,this.radius);this.setInteractive(c,o.Geom.Circle.Contains),this.lastGen=0}}class u{getInterval(){let t=Math.max(0,this.from.units);return Phaser.Math.Clamp(1/(.3+t/60)*1e3,220,2200)}update(t){if(!this.active||!this.scene.isClearPath(this.from.centerX,this.from.centerY,this.to.centerX,this.to.centerY))return;this.acc+=t,this.flowPhase=(this.flowPhase+.12*t)%1e4;let e=this.getInterval();this.acc>=e&&this.from.units>=1&&(this.acc-=e,this.scene.emitOne(this.from,this.to))}draw(t){let{from:e,to:s}=this;if(!this.scene.isClearPath(e.centerX,e.centerY,s.centerX,s.centerY))return;let i=Phaser.Math.Distance.Between(e.centerX,e.centerY,s.centerX,s.centerY),h=Math.max(2,Math.floor(i/18)),o=(s.centerX-e.centerX)/i,n=(s.centerY-e.centerY)/i;for(let s=0;s<h;s++){let h=(18*s+this.flowPhase)%i,r=e.centerX+o*h,l=e.centerY+n*h;t.fillStyle(9741240,.25),t.fillCircle(r,l,3),t.setDepth(10)}}constructor(t,e,s){(0,r._)(this,"scene",void 0),(0,r._)(this,"from",void 0),(0,r._)(this,"to",void 0),(0,r._)(this,"acc",0),(0,r._)(this,"flowPhase",0),(0,r._)(this,"active",!0),this.scene=t,this.from=e,this.to=s}}class p extends Phaser.GameObjects.Arc{static spawn(t,e,s,i,h){let o=new p(t,e,s,i,h),n=Phaser.Math.Angle.Between(i.centerX,i.centerY,h.centerX,h.centerY);return o.body.setVelocity(140*Math.cos(n),140*Math.sin(n)),o}destroyIfOutOfBounds(t){let e=t.cameras.main;return(this.x<e.worldView.x-50||this.x>e.worldView.x+e.worldView.width+50||this.y<e.worldView.y-50||this.y>e.worldView.y+e.worldView.height+50)&&(this.destroy(),!0)}constructor(t,e,s,i,h){super(t,e,s,6,0,360,!1,d(i.owner),1),(0,r._)(this,"targetTower",void 0),(0,r._)(this,"owner",void 0),this.targetTower=h,this.owner=i.owner,t.add.existing(this),t.physics.add.existing(this),this.body.setCircle(6),this.setDepth(20)}}function w(t){let e=t.getWorldTransformMatrix(),s=new(n()).Math.Vector2;return e.transformPoint(t.width/2,t.height/2,s),s}class x{static instance(t,e){return new x(t,()=>e,t=>{let s=e.indexOf(t);s>=0&&e.splice(s,1)},{strokeWidth:4,color:2278750,alpha:.2,maxPoints:20,minPointDist:8,depth:200,spark:!0,sparkColor:1483594})}bindInput(){let t=this.scene.input;t.on("pointerdown",(t,e)=>{e&&e.length>0||this.start(t.worldX,t.worldY)}),t.on("pointermove",t=>{this.isActive&&(this.pushPoint(t.worldX,t.worldY),this.redraw())}),t.on("pointerup",()=>{this.isActive&&this.finish()})}start(t,e){this.isActive=!0,this.points.length=0,this.points.push(new(n()).Math.Vector2(t,e)),this.redraw()}pushPoint(t,e){let s=this.points[this.points.length-1];(!s||n().Math.Distance.Between(t,e,s.x,s.y)>=this.opts.minPointDist)&&(this.points.push(new(n()).Math.Vector2(t,e)),this.points.length>this.opts.maxPoints&&this.points.shift())}redraw(){if(this.gfx.clear(),!(this.points.length<2)){this.gfx.lineStyle(this.opts.strokeWidth,this.opts.color,this.opts.alpha),this.gfx.beginPath(),this.gfx.moveTo(this.points[0].x,this.points[0].y);for(let t=1;t<this.points.length;t++)this.gfx.lineTo(this.points[t].x,this.points[t].y);this.gfx.strokePath(),this.gfx.lineStyle(Math.max(1,this.opts.strokeWidth-2),this.opts.color,.4);for(let t=1;t<this.points.length;t++)this.gfx.strokeLineShape(new(n()).Geom.Line(this.points[t-1].x,this.points[t-1].y,this.points[t].x,this.points[t].y))}}finish(){if(this.points.length<2)return void this.reset();let t=this.getLinks();for(let e=1;e<this.points.length;e++){let s=new(n()).Geom.Line(this.points[e-1].x,this.points[e-1].y,this.points[e].x,this.points[e].y);for(let e of t){if(!1===e.active)continue;let t=w(e.from),i=w(e.to),h=new(n()).Geom.Line(t.x,t.y,i.x,i.y);if(n().Geom.Intersects.LineToLine(s,h)){let t=x.getLineIntersectionPoint(s,h);this.opts.spark&&t&&this.spark(t.x,t.y),this.onCut(e,t??void 0)}}}this.reset()}reset(){this.isActive=!1,this.points.length=0,this.gfx.clear()}spark(t,e){let s=this.scene.add.graphics().setDepth(this.opts.depth+1);s.fillStyle(this.opts.sparkColor,.95),s.fillCircle(t,e,6),s.lineStyle(2,0xffffff,.9),s.strokeCircle(t,e,9),this.scene.tweens.add({targets:s,alpha:0,scale:1.35,duration:420,onComplete:()=>s.destroy()})}static getLineIntersectionPoint(t,e){let{x1:s,y1:i,x2:h,y2:o}=t,{x1:r,y1:l,x2:a,y2:c}=e,d=(s-h)*(l-c)-(i-o)*(r-a);if(1e-6>Math.abs(d))return null;let f=((s*o-i*h)*(r-a)-(s-h)*(r*c-l*a))/d,u=((s*o-i*h)*(l-c)-(i-o)*(r*c-l*a))/d,p=(t,e,s)=>t>=Math.min(s.x1,s.x2)-1e-6&&t<=Math.max(s.x1,s.x2)+1e-6&&e>=Math.min(s.y1,s.y2)-1e-6&&e<=Math.max(s.y1,s.y2)+1e-6;return p(f,u,t)&&p(f,u,e)?new(n()).Math.Vector2(f,u):null}constructor(t,e,s,i={}){(0,r._)(this,"scene",void 0),(0,r._)(this,"gfx",void 0),(0,r._)(this,"points",[]),(0,r._)(this,"isActive",!1),(0,r._)(this,"opts",void 0),(0,r._)(this,"getLinks",void 0),(0,r._)(this,"onCut",void 0),this.scene=t,this.getLinks=e,this.onCut=s,this.opts={strokeWidth:i.strokeWidth??4,color:i.color??0xff4444,alpha:i.alpha??.9,maxPoints:i.maxPoints??32,minPointDist:i.minPointDist??10,depth:i.depth??120,spark:i.spark??!0,sparkColor:i.sparkColor??0xff6b6b},this.gfx=t.add.graphics().setDepth(this.opts.depth),this.bindInput()}}class g extends n().Scene{create(){this.physics.world.setBounds(0,0,this.scale.width,this.scale.height),this.towers.push(f.spawn(this,320,140,"red",25)),this.towers.push(f.spawn(this,160,340,"neutral",5)),this.towers.push(f.spawn(this,450,560,"blue",19)),this.towers.push(f.spawn(this,0,0,"blue",19)),this.soldiers=this.add.group(),this.flowGfx=this.add.graphics(),this.obstacleGfx=this.add.graphics(),this.drawObstacles(),this.setupControls(),this.resultTxt=this.add.text(this.scale.width/2,36,"",{fontSize:"22px",color:"#111",fontStyle:"bold"}).setOrigin(.5).setDepth(100),x.instance(this,this.links)}setupControls(){this.input.keyboard&&this.input.keyboard.addKey(n().Input.Keyboard.KeyCodes.SPACE).on("down",()=>{console.log("The Space clicked!")}),this.input.on("pointerdown",(t,e)=>{let s=e.find(t=>t instanceof f);if(s&&!(!this.selectedTower&&"blue"!==s.owner)){if(!this.selectedTower&&"blue"===s.owner)return void this.setSelection(s);if(this.selectedTower&&s===this.selectedTower)return void this.setSelection(null);if(this.selectedTower&&"blue"===s.owner){let t=this.links.find(t=>t.from===this.selectedTower&&t.to===s);t?t.active=!0:this.links.push(new u(this,this.selectedTower,s)),this.setSelection(null);return}if(this.selectedTower&&"blue"!==s.owner)if(this.isClearPath(this.selectedTower.x,this.selectedTower.y,s.x,s.y)){console.log("WE CAN ATTACK :)");let t=this.links.find(t=>t.from===this.selectedTower&&t.to===s);t?t.active=!0:this.links.push(new u(this,this.selectedTower,s))}else console.log("WE CANNOT ATTACK :(");this.setSelection(null)}})}setSelection(t){this.selectedTower&&this.selectedTower.setSelected(!1),this.selectedTower=t,this.selectedTower&&this.selectedTower.setSelected(!0)}isClearPath(t,e,s,i){if(0===this.obstacles.length)return!0;let h=new o.Geom.Line(t,e,s,i);for(let t of this.obstacles){let e=new o.Geom.Rectangle(t.x,t.y,t.width,t.height);if(o.Geom.Intersects.GetLineToRectangle(h,e))return!1}return!0}emitOne(t,e){t.units<1||this.soldiers.add(p.spawn(this,t.centerX,t.centerY,t,e))}handleArrival(t,e){t.active&&(e.owner===t.owner?e.units=Math.min(e.units+1,60):(e.units-=1,e.units<0&&(e.setOwner(t.owner),e.units=1)),e.updateLabel(),t.destroy())}update(t,e){for(let t of this.towers)t.tick(e);for(let t of(this.flowGfx.clear(),this.links))t.update(e),t.draw(this.flowGfx);this.soldiers.getChildren().forEach(t=>{if(!t.active||t.destroyIfOutOfBounds(this))return;let e=t.targetTower;n().Math.Distance.Between(t.x,t.y,e.centerX,e.centerY)<=e.radius&&this.handleArrival(t,e)});let s=new Set(this.towers.map(t=>t.owner));if(1===s.size){let t=s.values().next().value;this.resultTxt.setText("blue"===t?"You won! \uD83C\uDF89":"You lost \uD83D\uDE48")}else this.resultTxt.setText("")}drawObstacles(){if(this.obstacleGfx.clear(),0!==this.obstacles.length)for(let t of(this.obstacleGfx.fillStyle(988970,.12),this.obstacleGfx.lineStyle(2,988970,.35),this.obstacles))this.obstacleGfx.fillRect(t.x,t.y,t.width,t.height),this.obstacleGfx.strokeRect(t.x,t.y,t.width,t.height)}constructor(){super("MainScene"),(0,r._)(this,"towers",[]),(0,r._)(this,"links",[]),(0,r._)(this,"soldiers",void 0),(0,r._)(this,"obstacles",[]),(0,r._)(this,"flowGfx",void 0),(0,r._)(this,"obstacleGfx",void 0),(0,r._)(this,"selectedTower",null),(0,r._)(this,"resultTxt",void 0)}}let v={type:n().AUTO,width:1024,height:1024,backgroundColor:"#eaf6ff",physics:{default:"arcade",arcade:{debug:!0}},scene:[g],scale:{mode:n().Scale.FIT,autoCenter:n().Scale.CENTER_BOTH}};new(n()).Game(v)}},o={};function n(t){var e=o[t];if(void 0!==e)return e.exports;var s=o[t]={exports:{}};return h[t].call(s.exports,s,s.exports,n),s.exports}n.m=h,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t=[],n.O=(e,s,i,h)=>{if(s){h=h||0;for(var o=t.length;o>0&&t[o-1][2]>h;o--)t[o]=t[o-1];t[o]=[s,i,h];return}for(var r=1/0,o=0;o<t.length;o++){for(var[s,i,h]=t[o],l=!0,a=0;a<s.length;a++)(!1&h||r>=h)&&Object.keys(n.O).every(t=>n.O[t](s[a]))?s.splice(a--,1):(l=!1,h<r&&(r=h));if(l){t.splice(o--,1);var c=i();void 0!==c&&(e=c)}}return e},e={889:0},n.O.j=t=>0===e[t],s=(t,s)=>{var i,h,[o,r,l]=s,a=0;if(o.some(t=>0!==e[t])){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(l)var c=l(n)}for(t&&t(s);a<o.length;a++)h=o[a],n.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return n.O(c)},(i=self.webpackChunktower_war_clone=self.webpackChunktower_war_clone||[]).forEach(s.bind(null,0)),i.push=s.bind(null,i.push.bind(i));var r=n.O(void 0,["851"],function(){return n(594)});r=n.O(r)})();